<ResourceDictionary
    x:Class="NINA.Plugins.PlateSolvePlus.Options"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <ResourceDictionary.MergedDictionaries>
        <!-- Falls du Converters.xaml im Projekt hast, darf das bleiben -->
        <ResourceDictionary Source="Converters.xaml"/>
    </ResourceDictionary.MergedDictionaries>

    <!-- =========================================
         Shared styles
         ========================================= -->
    <Style x:Key="FormRowLabel" TargetType="{x:Type TextBlock}">
        <Setter Property="Width" Value="220"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
        <Setter Property="Margin" Value="0,0,10,0"/>
    </Style>

    <Style x:Key="FormRow" TargetType="{x:Type StackPanel}">
        <Setter Property="Orientation" Value="Horizontal"/>
        <Setter Property="Margin" Value="0,0,0,8"/>
    </Style>

    <Style x:Key="HelpCard" TargetType="{x:Type Border}">
        <Setter Property="CornerRadius" Value="6"/>
        <Setter Property="Padding" Value="10"/>
        <Setter Property="Margin" Value="0,0,0,10"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="BorderBrush" Value="#33000000"/>
        <Setter Property="Background" Value="#11000000"/>
    </Style>

    <!-- Reusable: disable when a bound bool is false -->
    <Style x:Key="DisableWhenFalseTextBoxStyle" TargetType="{x:Type TextBox}">
        <Setter Property="IsEnabled" Value="True"/>
        <Setter Property="Opacity" Value="1"/>
        <Style.Triggers>
            <DataTrigger Binding="{Binding}" Value="False">
                <Setter Property="IsEnabled" Value="False"/>
                <Setter Property="Opacity" Value="0.6"/>
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <Style x:Key="DisableWhenFalseCheckBoxStyle" TargetType="{x:Type CheckBox}">
        <Setter Property="IsEnabled" Value="True"/>
        <Setter Property="Opacity" Value="1"/>
        <Style.Triggers>
            <DataTrigger Binding="{Binding}" Value="False">
                <Setter Property="IsEnabled" Value="False"/>
                <Setter Property="Opacity" Value="0.6"/>
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <DataTemplate x:Key="PlateSolvePlus_Options">
        <ScrollViewer VerticalScrollBarVisibility="Auto">

            <!-- Two-column layout -->
            <Grid Margin="10" HorizontalAlignment="Left">
                <Grid.ColumnDefinitions>
                    <!-- Left: settings -->
                    <ColumnDefinition Width="560"/>
                    <ColumnDefinition Width="20"/>
                    <!-- Right: help -->
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- =======================
                     LEFT COLUMN (SETTINGS)
                     ======================= -->
                <StackPanel Grid.Column="0"
                            Orientation="Vertical"
                            HorizontalAlignment="Left">

                    <TextBlock Text="PlateSolvePlus – Guide Scope Plate Solving"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Margin="0,0,0,12"/>

                    <!-- ========== Guider Capture ========== -->
                    <GroupBox Header="Guider Capture" Margin="0,0,0,10" HorizontalAlignment="Left">
                        <StackPanel Margin="10">

                            <StackPanel Style="{StaticResource FormRow}">
                                <TextBlock Style="{StaticResource FormRowLabel}"
                                           Text="Exposure (s)"
                                           ToolTip="Belichtungszeit der Guide-/Secondary-Kamera für das Platesolving."/>
                                <TextBox Width="140"
                                         ToolTip="Sekunden, z.B. 1.5"
                                         Text="{Binding Settings.GuideExposureSeconds, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                            <StackPanel Style="{StaticResource FormRow}">
                                <TextBlock Style="{StaticResource FormRowLabel}"
                                           Text="Gain"
                                           ToolTip="Gain der Secondary-Kamera."/>
                                <TextBox Width="140"
                                         ToolTip="z.B. 0..300 oder -1 (wenn unterstützt)"
                                         Text="{Binding Settings.GuideGain, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                            <StackPanel Style="{StaticResource FormRow}">
                                <TextBlock Style="{StaticResource FormRowLabel}"
                                           Text="Binning"
                                           ToolTip="Binning der Secondary-Kamera (typisch 1 oder 2)."/>
                                <TextBox Width="140"
                                         ToolTip="Ganzzahl >= 1"
                                         Text="{Binding Settings.GuideBinning, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                        </StackPanel>
                    </GroupBox>

                    <!-- ========== Optics / Scale ========== -->
                    <GroupBox Header="Optics / Scale" Margin="0,0,0,10" HorizontalAlignment="Left">
                        <StackPanel Margin="10">

                            <StackPanel Style="{StaticResource FormRow}">
                                <TextBlock Style="{StaticResource FormRowLabel}"
                                           Text="Focal Length (mm)"
                                           ToolTip="Brennweite des Guide-/Secondary-Setups (wichtig für Pixscale &amp; Solving-Parameter)."/>
                                <TextBox Width="140"
                                         ToolTip="z.B. 240"
                                         Text="{Binding Settings.GuideFocalLengthMm, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                            <CheckBox Content="Use camera pixel size"
                                      Margin="0,0,0,8"
                                      ToolTip="Wenn aktiv: Pixelgröße kommt aus Kamera/Profil. Wenn aus: Wert unten manuell eintragen."
                                      IsChecked="{Binding Settings.UseCameraPixelSize, UpdateSourceTrigger=PropertyChanged}"/>

                            <StackPanel Style="{StaticResource FormRow}">
                                <TextBlock Style="{StaticResource FormRowLabel}"
                                           Text="Pixel Size (µm)"
                                           ToolTip="Nur relevant, wenn 'Use camera pixel size' deaktiviert ist."/>
                                <TextBox Width="140"
                                         ToolTip="z.B. 3.75"
                                         Text="{Binding Settings.GuidePixelSizeUm, UpdateSourceTrigger=PropertyChanged}">
                                    <TextBox.Style>
                                        <Style TargetType="{x:Type TextBox}">
                                            <Setter Property="IsEnabled" Value="True"/>
                                            <Setter Property="Opacity" Value="1"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Settings.UseCameraPixelSize}" Value="True">
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                    <Setter Property="Opacity" Value="0.6"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>
                            </StackPanel>

                        </StackPanel>
                    </GroupBox>

                    <!-- ========== Solver ========== -->
                    <GroupBox Header="Solver" Margin="0,0,0,10" HorizontalAlignment="Left">
                        <StackPanel Margin="10">

                            <StackPanel Style="{StaticResource FormRow}">
                                <TextBlock Style="{StaticResource FormRowLabel}"
                                           Text="Search Radius (°)"
                                           ToolTip="Suchradius um die Startkoordinaten. Größer = robuster, aber langsamer."/>
                                <TextBox Width="140"
                                         ToolTip="z.B. 5"
                                         Text="{Binding Settings.SolverSearchRadiusDeg, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                            <StackPanel Style="{StaticResource FormRow}">
                                <TextBlock Style="{StaticResource FormRowLabel}"
                                           Text="Downsample"
                                           ToolTip="Downsample für den Solver (z.B. 2 = schneller)."/>
                                <TextBox Width="140"
                                         ToolTip="z.B. 2"
                                         Text="{Binding Settings.SolverDownsample, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                            <StackPanel Style="{StaticResource FormRow}">
                                <TextBlock Style="{StaticResource FormRowLabel}"
                                           Text="Timeout (s)"
                                           ToolTip="Maximale Zeit pro Solve-Versuch."/>
                                <TextBox Width="140"
                                         ToolTip="z.B. 60"
                                         Text="{Binding Settings.SolverTimeoutSec, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                        </StackPanel>
                    </GroupBox>

                    <!-- ========== Centering ========== -->
                    <GroupBox Header="Centering" Margin="0,0,0,10" HorizontalAlignment="Left">
                        <StackPanel Margin="10">

                            <StackPanel Style="{StaticResource FormRow}">
                                <TextBlock Style="{StaticResource FormRowLabel}"
                                           Text="Threshold (arcmin)"
                                           ToolTip="Zielgenauigkeit: maximaler Restfehler in Bogenminuten."/>
                                <TextBox Width="140"
                                         ToolTip="z.B. 1.0"
                                         Text="{Binding Settings.CenteringThresholdArcmin, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                            <StackPanel Style="{StaticResource FormRow}">
                                <TextBlock Style="{StaticResource FormRowLabel}"
                                           Text="Max attempts"
                                           ToolTip="Maximale Iterationen (Solve → Korrektur → Slew/Sync)."/>
                                <TextBox Width="140"
                                         ToolTip="z.B. 5"
                                         Text="{Binding Settings.CenteringMaxAttempts, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                        </StackPanel>
                    </GroupBox>

                    <!-- ========== Offset ========== -->
                    <GroupBox Header="Offset" Margin="0,0,0,10" HorizontalAlignment="Left">
                        <StackPanel Margin="10">

                            <CheckBox Content="Offset verwenden"
                                      ToolTip="Wenn aktiv: Guider-Solve wird über Offset-Modell auf Main-Sky gemappt."
                                      IsChecked="{Binding Settings.OffsetEnabled, UpdateSourceTrigger=PropertyChanged}"
                                      Margin="0,0,0,10"/>

                            <StackPanel Style="{StaticResource FormRow}">
                                <TextBlock Style="{StaticResource FormRowLabel}"
                                           Text="Mode"
                                           ToolTip="Rotation: nicht-koaxiale Anordnung. Arcsec: klassische ΔRA/ΔDec."/>
                                <ComboBox Width="220"
                                          ToolTip="0=Rotation, 1=Arcsec"
                                          SelectedIndex="{Binding Settings.OffsetModeInt, UpdateSourceTrigger=PropertyChanged}">
                                    <ComboBoxItem Content="Rotation (recommended)"/>
                                    <ComboBoxItem Content="Arcsec (ΔRA/ΔDec)"/>
                                    <ComboBox.Style>
                                        <Style TargetType="{x:Type ComboBox}">
                                            <Setter Property="IsEnabled" Value="True"/>
                                            <Setter Property="Opacity" Value="1"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Settings.OffsetEnabled}" Value="False">
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                    <Setter Property="Opacity" Value="0.6"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ComboBox.Style>
                                </ComboBox>
                            </StackPanel>

                        </StackPanel>
                    </GroupBox>

                    <!-- ========== Touch-N-Stars / Local API ========== -->
                    <GroupBox Header="Touch-N-Stars / Local API" Margin="0,0,0,10" HorizontalAlignment="Left">
                        <StackPanel Margin="10">

                            <CheckBox Content="Local API aktivieren (localhost)"
                                      ToolTip="Startet einen lokalen API-Host (Trigger/Results/Preview für Touch-N-Stars)."
                                      IsChecked="{Binding Settings.ApiEnabled, UpdateSourceTrigger=PropertyChanged}"/>

                            <StackPanel Style="{StaticResource FormRow}" Margin="0,10,0,0">
                                <TextBlock Style="{StaticResource FormRowLabel}"
                                           Text="Port"
                                           ToolTip="TCP-Port des API-Hosts (z.B. 1899)."/>
                                <TextBox Width="140"
                                         ToolTip="z.B. 17890"
                                         Text="{Binding Settings.ApiPort, UpdateSourceTrigger=PropertyChanged}">
                                    <TextBox.Style>
                                        <!-- bind directly to ApiEnabled by using a nested binding via DataTrigger -->
                                        <Style TargetType="{x:Type TextBox}">
                                            <Setter Property="IsEnabled" Value="True"/>
                                            <Setter Property="Opacity" Value="1"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Settings.ApiEnabled}" Value="False">
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                    <Setter Property="Opacity" Value="0.6"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>
                            </StackPanel>

                            <CheckBox Content="API-Zugriff mit Token absichern"
                                      Margin="0,6,0,0"
                                      ToolTip="Wenn aktiv: Requests müssen einen Token mitsenden."
                                      IsChecked="{Binding Settings.ApiRequireToken, UpdateSourceTrigger=PropertyChanged}">
                                <CheckBox.Style>
                                    <Style TargetType="{x:Type CheckBox}">
                                        <Setter Property="IsEnabled" Value="True"/>
                                        <Setter Property="Opacity" Value="1"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Settings.ApiEnabled}" Value="False">
                                                <Setter Property="IsEnabled" Value="False"/>
                                                <Setter Property="Opacity" Value="0.6"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </CheckBox.Style>
                            </CheckBox>

                            <StackPanel Style="{StaticResource FormRow}" Margin="0,8,0,0">
                                <TextBlock Style="{StaticResource FormRowLabel}"
                                           Text="API-Token"
                                           ToolTip="Token für Auth (nur genutzt, wenn Require Token aktiv ist)."/>
                                <TextBox Width="280"
                                         ToolTip="Wird nur genutzt, wenn 'Require Token' aktiv ist."
                                         Text="{Binding Settings.ApiToken, UpdateSourceTrigger=PropertyChanged}">
                                    <TextBox.Style>
                                        <Style TargetType="{x:Type TextBox}">
                                            <Setter Property="IsEnabled" Value="True"/>
                                            <Setter Property="Opacity" Value="1"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Settings.ApiEnabled}" Value="False">
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                    <Setter Property="Opacity" Value="0.6"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Settings.ApiRequireToken}" Value="False">
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                    <Setter Property="Opacity" Value="0.6"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>
                            </StackPanel>

                        </StackPanel>
                    </GroupBox>

                </StackPanel>

                <!-- =======================
                     RIGHT COLUMN (HELP)
                     ======================= -->
                <StackPanel Grid.Column="2"
                            Orientation="Vertical"
                            HorizontalAlignment="Left">

                    <TextBlock Text="Hilfe / Hinweise"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Margin="0,0,0,12"/>

                    <Border Style="{StaticResource HelpCard}">
                        <StackPanel>
                            <TextBlock Text="Guider Capture" FontWeight="SemiBold" Margin="0,0,0,6"/>
                            <TextBlock TextWrapping="Wrap">
                                Werte für die Aufnahme der Secondary-Kamera, die fürs Platesolving verwendet wird.
                                Kürzere Exposure ist schneller, aber weniger robust bei schwachen Sternen.
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource HelpCard}">
                        <StackPanel>
                            <TextBlock Text="Optics / Scale" FontWeight="SemiBold" Margin="0,0,0,6"/>
                            <TextBlock TextWrapping="Wrap">
                                Brennweite und Pixelgröße beeinflussen die Pixscale und damit die Solver-Performance.
                                Wenn möglich: Pixelgröße aus dem Kameraprofil verwenden.
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource HelpCard}">
                        <StackPanel>
                            <TextBlock Text="Solver" FontWeight="SemiBold" Margin="0,0,0,6"/>
                            <TextBlock TextWrapping="Wrap">
                                Search Radius größer = toleranter, aber langsamer. Downsample 2 ist meist ein guter Kompromiss.
                                Timeout schützt vor Hängern.
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource HelpCard}">
                        <StackPanel>
                            <TextBlock Text="Offset" FontWeight="SemiBold" Margin="0,0,0,6"/>
                            <TextBlock TextWrapping="Wrap">
                                Rotation ist der Standard für nicht-koaxiale Anordnungen. Arcsec ist eher klassisch (ΔRA/ΔDec).
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource HelpCard}">
                        <StackPanel>
                            <TextBlock Text="Local API (Touch-N-Stars)" FontWeight="SemiBold" Margin="0,0,0,6"/>
                            <TextBlock TextWrapping="Wrap">
                                Aktiviert einen lokalen HTTP-Server (localhost). Port ändern bei Konflikten.
                                Token nur aktivieren, wenn du den Zugriff absichern willst.
                            </TextBlock>
                        </StackPanel>
                    </Border>

                </StackPanel>

            </Grid>
        </ScrollViewer>
    </DataTemplate>

</ResourceDictionary>

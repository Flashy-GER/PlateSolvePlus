<UserControl x:Class="NINA.Plugins.PlateSolvePlus.PlatesolveplusDockables.CameraDockableView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="900"
             d:DesignWidth="520">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- Header / Status -->
            <RowDefinition Height="Auto"/>  <!-- Camera selection / buttons -->
            <RowDefinition Height="Auto"/>  <!-- Solve texts -->
            <RowDefinition Height="Auto"/>  <!-- Readonly settings -->
            <RowDefinition Height="*"/>     <!-- Image preview -->
        </Grid.RowDefinitions>

        <!-- =========================
             Header / Status
             ========================= -->
        <Border Grid.Row="0"
                Padding="10"
                CornerRadius="6"
                BorderThickness="1"
                BorderBrush="#22000000"
                Background="#0A000000"
                Margin="0,0,0,10">
            <StackPanel>
                <TextBlock Text="{Binding StatusText}"
                           FontWeight="SemiBold"
                           FontSize="14"/>
                <TextBlock Text="{Binding DetailsText}"
                           TextWrapping="Wrap"
                           Margin="0,4,0,0"/>
            </StackPanel>
        </Border>

        <!-- =========================
             Secondary Camera + Buttons
             ========================= -->
        <GroupBox Grid.Row="1" Header="Secondary Camera" Margin="0,0,0,10">
            <StackPanel Margin="10">

                <TextBlock Text="Select camera:" Margin="0,0,0,4"/>
                <ComboBox ItemsSource="{Binding SecondaryCameraDevices}"
                          SelectedItem="{Binding SelectedSecondaryCamera}"
                          DisplayMemberPath="Name"
                          Margin="0,0,0,10"/>

                <WrapPanel Margin="0,0,0,10">
                    <Button Content="Rescan ASCOM"
                            Width="120"
                            Margin="0,0,8,8"
                            Command="{Binding RefreshSecondaryCameraListCommand}"/>

                    <Button Content="Driver Settings"
                            Width="120"
                            Margin="0,0,8,8"
                            Command="{Binding OpenDriverSettingsCommand}"/>

                    <Button Content="Connect"
                            Width="90"
                            Margin="0,0,8,8"
                            Command="{Binding ConnectSecondaryCommand}"/>

                    <Button Content="Disconnect"
                            Width="90"
                            Margin="0,0,8,8"
                            Command="{Binding DisconnectSecondaryCommand}"/>

                    <!-- NEW: Capture only -->
                    <Button Content="Capture"
                            Width="110"
                            Margin="0,0,8,8"
                            Command="{Binding CaptureOnlyCommand}"
                            IsEnabled="{Binding CanCaptureAndSolve}"/>

                    <!-- Existing: Capture + Sync/Slew -->
                    <Button Content="{Binding CaptureAndSolveButtonText}"
                            Width="140"
                            Margin="0,0,8,8"
                            Command="{Binding CaptureAndSolveCommand}"
                            IsEnabled="{Binding CanCaptureAndSolve}"/>

                    <Button Content="Calibrate Offset"
                            Width="140"
                            Margin="0,0,8,8"
                            Command="{Binding CalibrateOffsetCommand}"
                            IsEnabled="{Binding CanCalibrateOffset}"/>
                </WrapPanel>

                <CheckBox Content="Center and Sync"
                          IsChecked="{Binding UseSlewInsteadOfSync}"
                          Margin="0,0,0,10"/>

                <Separator Margin="0,0,0,10"/>

                <TextBlock Text="{Binding MountStatusText}"
                           FontWeight="SemiBold"
                           Margin="0,0,0,4"/>

                <TextBlock Text="{Binding MountDetailsText}"
                           TextWrapping="Wrap"
                           Margin="0,0,0,6"/>

                <TextBlock Text="{Binding OffsetStatusText}"
                           TextWrapping="Wrap"/>
            </StackPanel>
        </GroupBox>

        <!-- =========================
             Solve Texts (3 lines)
             ========================= -->
        <GroupBox Grid.Row="2" Header="Solve Output" Margin="0,0,0,10">
            <StackPanel Margin="10">

                <!-- 1) Last guider solve text -->
                <TextBlock Text="{Binding LastGuiderSolveText}"
                           TextWrapping="Wrap"
                           Margin="0,0,0,8"/>

                <!-- 2) Last solve result (raw / summary) -->
                <TextBox Text="{Binding LastSolveSummary}"
                         TextWrapping="Wrap"
                         IsReadOnly="True"
                         VerticalScrollBarVisibility="Auto"
                         Height="110"
                         Margin="0,0,0,8"/>

                <!-- 3) corrected coordinates after offset -->
                <TextBlock Text="{Binding CorrectedSolveText}"
                           TextWrapping="Wrap"/>
            </StackPanel>
        </GroupBox>

        <!-- =========================
             Readonly camera settings
             ========================= -->
        <GroupBox Grid.Row="3" Header="Camera settings (readonly from Options)" Margin="0,0,0,10">
            <Grid Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="220"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Grid.Column="0" Text="Exposure (sec)" VerticalAlignment="Center"/>
                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding GuideExposureSeconds}"/>

                <TextBlock Grid.Row="1" Grid.Column="0" Text="Gain (-1 = Auto)" VerticalAlignment="Center"/>
                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding GuideGain}"/>

                <TextBlock Grid.Row="2" Grid.Column="0" Text="Binning" VerticalAlignment="Center"/>
                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding GuideBinning}"/>

                <TextBlock Grid.Row="3" Grid.Column="0" Text="Focal Length (mm)" VerticalAlignment="Center"/>
                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding GuideFocalLengthMm}"/>

                <TextBlock Grid.Row="4" Grid.Column="0" Text="Pixel Size (Âµm)" VerticalAlignment="Center"/>
                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding GuidePixelSizeUm}"/>
            </Grid>
        </GroupBox>

        <!-- =========================
             Image preview (stretched)
             ========================= -->
        <GroupBox Grid.Row="4" Header="Image Preview">
            <Border Margin="10"
                    BorderThickness="1"
                    BorderBrush="#33000000"
                    CornerRadius="4"
                    Padding="6">
                <Grid>
                    <!-- Background checker/placeholder feel -->
                    <Border Background="#08000000"/>

                    <Image Source="{Binding LastCapturedImage}"
                           Stretch="Uniform"
                           RenderOptions.BitmapScalingMode="HighQuality"/>
                </Grid>
            </Border>
        </GroupBox>

    </Grid>
</UserControl>
